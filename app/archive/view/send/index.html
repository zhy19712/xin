{include file="../../public/common_header"}
<style>
    .dataTables_wrapper, .tbcontainer {
        display: block;
    }
    #tableIncome thead tr th{
        text-align: center;
    }
    #file_modal{
        display: none;
    }
    #fileOperation{
        text-align: center;
        position: relative;
        top: 160px;
    }
    #fileOperation button{
        width: 90px;
    }
</style>
<div class="layui-fluid">
    <div class="layui-row">
        <table id="tableIncome" class="layui-table" cellspacing="0"  width="100%">
            <thead>
            <tr>
                <th>文件名称</th>
                <th>文件日期</th>
                <th>来文单位</th>
                <th>发件人</th>
                <th>收件人</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
            </thead>
        </table>
    </div>
</div>
<!--文件查看以及处理-->
<div id="file_modal">
    <div class="layui-form">
        <div class="layui-form-item">
            <label class="layui-form-label">文件名称</label>
            <div class="layui-input-block">
                <input type="text" name="fileName"  class="layui-input" readonly>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">文件日期</label>
            <div class="layui-input-block">
                <input type="text" name="fileDate"  class="layui-input" readonly>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">发件人</label>
            <div class="layui-input-block">
                <input type="text" name="fileDate"  class="layui-input" readonly>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">来文单位</label>
            <div class="layui-input-block">
                <input type="text" name="fileDate"  class="layui-input" readonly>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">备注</label>
            <div class="layui-input-block">
                <input type="text" name="fileDate"  class="layui-input" readonly>
            </div>
        </div>
        <!--附件资料-->
        <div class="layui-form-item">
            <label class="layui-form-label">文件附件</label>
            <div class="layui-input-block">
                <table id="tableFiles" class="layui-table" cellspacing="0"  width="100%">
                    <thead>
                    <tr>
                        <th class="layui-col-xs-9">文件名称</th>
                        <th class="layui-col-xs-9">操作</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
    <div class="layui-row" id="fileOperation">
        <button class="layui-btn layui-btn-normal">签收</button>
        <button class="layui-btn layui-btn-primary">拒收</button>
    </div>
</div>
{include file="../../public/common_footer"}
</body>
<script type="text/javascript">
    $("#tableIncome").DataTable({
        processing: true,
        ordering: false,
        ajax: {
            "url": "{:url('/archive/common/datatablesPre')}?tableName=archive_income_send&table_type=2",
        },
        columns: [
            { "data": "file_name" },
            { "data": "date" },
            { "data": "unit_name" },
            { "data": "name"},
            { "data": "income_name" },
            { "data": "status" },
            { "data": "status" }
        ],
        columnDefs: [
            {
                targets: [3],
                render: function (data, type, row,meta) {
                    return  'admin';
                }
            },
            {
                targets: [6],
                render: function (data, type, row,meta) {
                    if (data == '未处理'){
                        return  '<a title="' + data + '" href="javascript:void(0);" data-fileId="'+row.id+'" onclick=\"incomeShow(this)\">处理</a>';
                    }else {
                        return  '<a title="' + data + '" href="javascript:void(0);" data-fileId="'+row.id+'" onclick=\"incomeShow(this)\">查看</a>';
                    }
                }
            }
        ],
        dom: 'frtp',
        language: {
            "lengthMenu": "_MENU_",
            "zeroRecords": "没有找到记录",
            "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
            "infoEmpty": "无记录",
            "search": "搜索：",
            "infoFiltered": "(从 _MAX_ 条记录过滤)",
            "paginate": {
                "sFirst": "<<",
                "sPrevious": "<",
                "sNext": ">",
                "sLast": ">>"
            }
        }
    })
    function incomeShow(that) {
        var txt = $(that).attr("title");
        layer.open({
            type: 1,
            title:null,
            closeBtn: true,
            shade:0.5,
            shadeClose: true,
            area:["800px","600px"],
            content: $('#file_modal')
        });
        if (txt == "未处理"){
            $("#fileOperation").css("display","block");
        }else{
            $("#fileOperation").css("display","none");
        }
    }
</script>
</html>