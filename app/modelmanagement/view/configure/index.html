{include file="../../public/common_header"}
<link rel="stylesheet" href="__PUBLIC__/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="__PUBLIC__/colorpicker/css/bootstrap-colorpicker.css">
<style>
    h4{
        line-height: 30px;
        text-indent: 1em;
        color: #1E9FFF;
    }
    h4 span{
        position: relative;
        top: -2px;
    }
    fieldset {
        display: block;
        -webkit-margin-start: 2px;
        -webkit-margin-end: 2px;
        -webkit-padding-start: 0.75em;
        -webkit-padding-end: 0.75em;
        -webkit-padding-after: 0.625em;
        min-width: -webkit-min-content;
        border-width: 2px;
        border-style: groove;
        border-color: #EEEEEE;
        border-image: initial;
    }
    .legends {
        width: auto;
        font-size: 16px;
        display: block;
        -webkit-padding-start: 2px;
        -webkit-padding-end: 2px;
        border-width: initial;
        border-style: none;
        border-color: initial;
        border-image: initial;
    }
</style>
<div class="layui-fuild" id="formContent">
    <!--首页-->
    <div class="layui-row">
        <h4 class=""><i class="glyphicon glyphicon-record"></i><span>首页3D效果配置</span></h4>
        <form class="layui-form" action="" style="padding: 5px 40px">
            <fieldset>
                <legend class="legends">选择集</legend>
                <div class="layui-row">
                    <div class="layui-form-item layui-col-xs7 pull-right">
                        <label class="layui-form-label" style="width: 150px;">选择集透明度</label>
                        <div class="layui-input-inline input-group ">
                            <input  id="pellucidity_home" type="text" name="pellucidity" style="width: 254px;" class="form-control input-lg" onchange="opcityControl(this)"/>
                            <input  type="hidden" name="major_key" value="1"/>
                            <span class="input-group-addon"><i class="glyphicon glyphicon-pencil"></i></span>
                        </div>
                        <div class="layui-form-mid layui-word-aux">(ps:透明度的值必须为0到1之间)</div>
                    </div>
                    <div class=" layui-col-xs4">
                        <label class="layui-form-label" style="width: 150px;">选择集颜色</label>
                        <div id="pigment_home_color" class="layui-input-block input-group colorpicker-component" title="Using input value">
                            <input type="text" name="pigment"  id="pigment_home" class="form-control input-lg"/>
                            <span class="input-group-addon"><i></i></span>
                        </div>
                    </div>
                </div>
            </fieldset>
            <fieldset>
                <legend class="legends">透明效果</legend>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 150px;">透明效果的透明度</label>
                    <div class="layui-input-inline input-group" style="width: 294px">
                        <input type="text"  id="transparent_effect_home" name="transparent_effect" class="form-control input-lg" onchange="opcityControl(this)"/>
                        <span class="input-group-addon"><i class="glyphicon glyphicon-pencil"></i></span>
                    </div>
                    <div class="layui-form-mid layui-word-aux">(ps:透明度的值必须为0到1之间)</div>
                </div>
            </fieldset>
            <div class="layui-form-item" style="margin-top: 20px;">
                <div class="layui-input-block" style="text-align: center;">
                    <button class="layui-btn" lay-submit lay-filter="homeApply">应用</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>
    <!--质量-->
    <div class="layui-row">
        <h4 class=""><i class="glyphicon glyphicon-record"></i><span>质量3D效果配置</span></h4>
        <form class="layui-form" action="" style="padding: 5px 40px">
            <fieldset>
                <legend class="legends">选择集</legend>
                <div class="layui-form-item layui-col-xs7 pull-right">
                    <label class="layui-form-label" style="width: 150px;">选择集透明度</label>
                    <div class="layui-input-inline input-group ">
                        <input  id="pellucidity_quality" type="text" name="pellucidity" class="form-control input-lg" style="width: 254px;" onchange="opcityControl(this)"/>
                        <span class="input-group-addon"><i class="glyphicon glyphicon-pencil"></i></span>
                    </div>
                    <div class="layui-form-mid layui-word-aux">(ps:透明度的值必须为0到1之间)</div>
                </div>
                <div class="layui-col-xs4">
                    <label class="layui-form-label" style="width: 150px;">选择集颜色</label>
                    <div id="pigment_quality_color" class="layui-input-block input-group colorpicker-component" title="Using input value" style="width: 314px;">
                        <input  id="pigment_quality" type="text" name="pigment" class="form-control input-lg"/>
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </fieldset>
            <fieldset>
                <legend class="legends">验评结果</legend>
                <div class="layui-col-xs4">
                    <label class="layui-form-label" style="width: 150px;">优良颜色</label>
                    <div id="choiceness_pigment_color" class="layui-input-block input-group colorpicker-component" title="Using input value">
                        <input type="text"  id="choiceness_pigment" name="choiceness_pigment" class="form-control input-lg"/>
                        <input  type="hidden" name="major_key" value="2"/>
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>

                <div class="layui-col-xs4">
                    <label class="layui-form-label" style="width: 150px;">合格颜色</label>
                    <div id="qualified_pigment_color" class="layui-input-block input-group colorpicker-component" title="Using input value">
                        <input type="text"  id="qualified_pigment" name="qualified_pigment" class="form-control input-lg"/>
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
                <div class="layui-col-xs4">
                    <label class="layui-form-label" style="width: 150px;">不合格颜色</label>
                    <div id="un_evaluation_pigment_color" class="layui-input-block input-group colorpicker-component" title="Using input value">
                        <input type="text"  id="un_evaluation_pigment" name="un_evaluation_pigment" class="form-control input-lg"/>
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </fieldset>
            <div class="layui-form-item" style="margin-top: 20px">
                <div class="layui-input-block" style="text-align: center">
                    <button class="layui-btn" lay-submit lay-filter="qualityApply">应用</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>
</div>
{include file="../../public/common_footer"}
<script type="text/javascript" src="__PUBLIC__/jquery/jquery.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/colorpicker/js/bootstrap-colorpicker.js"></script>
</body>
<script type="text/javascript">
    $.ajax({
        url:"./index",
        type:"get",
        success:function (res) {
            console.log(res);
            if (res.code == 1){
                var panorama = res.data.panorama;
                var quality = res.data.quality;
                $("#pellucidity_home").val(panorama.pellucidity);
                $("#transparent_effect_home").val(panorama.transparent_effect);
                $("#pigment_home").val(splitPrefix(panorama.pigment));
                $("#pellucidity_quality").val(quality.pellucidity);
                $("#pigment_quality").val(splitPrefix(quality.pigment));
                $("#choiceness_pigment").val(splitPrefix(quality.pigment));
                $("#qualified_pigment").val(splitPrefix(quality.pigment));
                $("#un_evaluation_pigment").val(splitPrefix(splitPrefix(quality.pigment)));
                //初始化调色盘
                $('#pigment_home_color,#pigment_quality_color,#choiceness_pigment_color,#qualified_pigment_color,#un_evaluation_pigment_color').colorpicker({

                });
                $('#pigment_home_color').on('changeColor',function (e) {
                    $(this).find('input').css('background-color',e.color.toHex());
                })
            }
        }
    })

    //3D效果配置
    layui.use('form', function(){
        var form = layui.form;
        //首页
        form.on('submit(homeApply)', function(data){

            data.field.pigment = joinPrefix(data.field.pigment);
            data.field.model_type = '1';
            formSubmit(data);
            return false;
        });
        //质量
        form.on('submit(qualityApply)', function(data){
            data.field.pigment = joinPrefix(data.field.pigment);
            data.field.choiceness_pigment = joinPrefix(data.field.choiceness_pigment);
            data.field.qualified_pigment = joinPrefix(data.field.qualified_pigment);
            data.field.un_evaluation_pigment = joinPrefix(data.field.un_evaluation_pigment);
            data.field.model_type = '2';
            formSubmit(data);
            return false;
        });
    });
    function formSubmit(data) {
        $.ajax({
            url: "./edit",
            type: "post",
            data:data.field,
            dataType: "json",
            success: function (res) {
                layer.msg(res.msg);
            }
        });
    }
    //颜色格式
    function splitPrefix(val) {
        val = "#"+ val.substr(val.length-6);
        return val;

    }
    function joinPrefix(val) {
        val = "0x64"+ val.substr(val.length-6);
        return val;
    }
    // 透明度输入控制
    function opcityControl(that) {
        var val = $(that).val();
        var arr = ['0','0.1','0.2','0.3','0.4','0.5','0.6','0.7','0.8','0.9','1'];
        if (arr.indexOf(val) == '-1'){
            $(that).val('');
        }else{
            $(that).val(val);
        }
    }
</script>
</html>
